# Heartbeat Task Automation Configuration
# å¿ƒè·³ä»»å‹™è‡ªå‹•åŒ–é…ç½®

version: "1.0.0"
name: "Heartbeat Task Automation System"

# åŸ·è¡Œæ™‚é–“é…ç½®
schedule:
  times:
    - "08:00"  # æ—©æ™¨
    - "14:00"  # åˆå¾Œ
    - "20:00"  # æ™šé–“
  
  timezone: "Asia/Taipei"

# å¿ƒè·³ä»»å‹™å®šç¾©
heartbeat_tasks:
  
  # Task 1: GitHub Skill Search
  github_skill_search:
    name: "GitHub æŠ€èƒ½æœå°‹"
    description: "æœå°‹ä¸¦å®‰è£æ–°çš„ ClawHub Skills"
    schedule: "08:00, 20:00"  # æ¯å¤©2æ¬¡
    enabled: true
    
    # æœå°‹é—œéµå­—
    search_keywords:
      - "research"
      - "ai"
      - "productivity"
      - "learning"
      - "automation"
    
    # é€£å‹•æŠ€èƒ½
    linked_skills:
      - skill: "clawhub"
        action: "search"
        priority: 1
      - skill: "github"
        action: "search_repos"
        priority: 2
      - skill: "opencode"
        action: "generate_code"
        priority: 3  # è‡ªå‹•å®‰è£è…³æœ¬
    
    # è¼¸å‡ºé…ç½®
    output:
      dir: "./outputs/github_skills"
      format: "markdown"
      filename: "skill_search_{date}.md"
    
    # è‡ªå‹•åŒ–è…³æœ¬
    script: "python3 /Users/pc/.openclaw/workspace/scripts/github-skill-search.py"
    
    # è§¸ç™¼æ¢ä»¶
    trigger:
      type: "schedule"
      time: "08:00, 20:00"
    
    # é€šçŸ¥é…ç½®
    notification:
      enabled: true
      channel: "telegram"
      message: "âœ… GitHub æŠ€èƒ½æœå°‹å®Œæˆï¼Œæ‰¾åˆ° {count} å€‹æ–°æŠ€èƒ½"
  
  # Task 2: System Health Check
  system_health_check:
    name: "ç³»çµ±å¥åº·æª¢æŸ¥"
    description: "æª¢æŸ¥ Cron å·¥ä½œã€é—œéµæª”æ¡ˆã€å­ä»£ç†ç‹€æ…‹"
    schedule: "08:00, 14:00, 20:00"  # æ¯å¤©3æ¬¡
    enabled: true
    
    # æª¢æŸ¥é …ç›®
    check_items:
      - "cron_status"
      - "files_exist"
      - "subagents_running"
      - "memory_usage"
      - "disk_usage"
    
    # é€£å‹•æŠ€èƒ½
    linked_skills:
      - skill: "healthcheck"
        action: "full_check"
        priority: 1
      - skill: "system-architect"
        action: "analyze_system"
        priority: 2
      - skill: "ping-monitor"
        action: "monitor_services"
        priority: 3
    
    # è¼¸å‡ºé…ç½®
    output:
      dir: "./outputs/health_checks"
      format: "json"
      filename: "health_{timestamp}.json"
    
    # è‡ªå‹•åŒ–è…³æœ¬
    script: "python3 /Users/pc/.openclaw/workspace/scripts/heartbeat-check.py"
    
    # è§¸ç™¼æ¢ä»¶
    trigger:
      type: "schedule"
      time: "08:00, 14:00, 20:00"
    
    # é€šçŸ¥é…ç½®
    notification:
      enabled: true
      channel: "telegram"
      message: "ğŸ©º ç³»çµ±å¥åº·æª¢æŸ¥å®Œæˆï¼Œå¥åº·åˆ†æ•¸: {score}%"
    
    # éŒ¯èª¤è™•ç†
    error_handling:
      on_failure: "retry"
      max_retries: 3
      retry_interval: 60
  
  # Task 3: Knowledge Extraction
  knowledge_extraction:
    name: "çŸ¥è­˜æå–"
    description: "è®€å–è¨˜æ†¶ã€è­˜åˆ¥æŠ€èƒ½ã€ç”Ÿæˆå ±å‘Š"
    schedule: "14:00"  # æ¯å¤©1æ¬¡
    enabled: true
    
    # æå–ä¾†æº
    sources:
      - "memory/daily"
      - "memory/long_term"
      - "research_memories"
    
    # é€£å‹•æŠ€èƒ½
    linked_skills:
      - skill: "research-evolution"
        action: "extract_knowledge"
        priority: 1
      - skill: "memory-hygiene"
        action: "organize_memory"
        priority: 2
      - skill: "literature-review-agent"
        action: "review_papers"
        priority: 3  # è­˜åˆ¥å¯å›é¡§è«–æ–‡
      - skill: "zettelkasten"
        action: "update_notes"
        priority: 4  # æ›´æ–°ç­†è¨˜
    
    # è¼¸å‡ºé…ç½®
    output:
      dir: "./outputs/knowledge_extraction"
      format: "markdown"
      filename: "extraction_{date}.md"
    
    # è‡ªå‹•åŒ–è…³æœ¬
    script: "bash /Users/pc/.openclaw/workspace/scripts/knowledge-extractor.sh"
    
    # è§¸ç™¼æ¢ä»¶
    trigger:
      type: "schedule"
      time: "14:00"
    
    # é€šçŸ¥é…ç½®
    notification:
      enabled: true
      channel: "telegram"
      message: "ğŸ§  çŸ¥è­˜æå–å®Œæˆï¼Œç™¼ç¾ {skills} å€‹å¯æå–æŠ€èƒ½"

# é€£å‹•è§¸ç™¼é…ç½®
linkage_triggers:
  
  # GitHub æœå°‹å®Œæˆ â†’ å®‰è£æŠ€èƒ½
  on_github_search_complete:
    trigger_task: "github_skill_search"
    condition:
      type: "new_skills_found"
      threshold: 1
    actions:
      - skill: "opencode"
        action: "generate_install_script"
        params:
          skills: "{new_skills}"
      - skill: "github"
        action: "create_pr"
        params:
          title: "Add new skills"
      
  # å¥åº·æª¢æŸ¥å®Œæˆ â†’ ä¿®å¾©å•é¡Œ
  on_health_check_complete:
    trigger_task: "system_health_check"
    condition:
      type: "health_score"
      operator: "lt"
      threshold: 80
    actions:
      - skill: "system-architect"
        action: "suggest_fix"
      - skill: "healthcheck"
        action: "run_repairs"
      
  # çŸ¥è­˜æå–å®Œæˆ â†’ æ›´æ–°ç­†è¨˜
  on_knowledge_extraction_complete:
    trigger_task: "knowledge_extraction"
    condition:
      type: "new_insights"
      threshold: 1
    actions:
      - skill: "zettelkasten"
        action: "create_notes"
      - skill: "obsidian"
        action: "sync_vault"

# Cron æ’ç¨‹é…ç½®
cron_config:
  timezone: "Asia/Taipei"
  
  jobs:
    - name: "github_skill_search_morning"
      task: "github_skill_search"
      schedule: "0 8 * * *"
      enabled: true
      
    - name: "github_skill_search_evening"
      task: "github_skill_search"
      schedule: "0 20 * * *"
      enabled: true
      
    - name: "health_check_morning"
      task: "system_health_check"
      schedule: "0 8 * * *"
      enabled: true
      
    - name: "health_check_afternoon"
      task: "system_health_check"
      schedule: "0 14 * * *"
      enabled: true
      
    - name: "health_check_evening"
      task: "system_health_check"
      schedule: "0 20 * * *"
      enabled: true
      
    - name: "knowledge_extraction"
      task: "knowledge_extraction"
      schedule: "0 14 * * *"
      enabled: true

# é€šçŸ¥é…ç½®
notifications:
  telegram:
    enabled: true
    chat_id: "${TELEGRAM_CHAT_ID}"
    bot_token: "${TELEGRAM_BOT_TOKEN}"
    
  email:
    enabled: false
    smtp_server: "${SMTP_SERVER}"
    sender: "${EMAIL_SENDER}"
    
# è¼¸å‡ºé…ç½®
outputs:
  base_dir: "./outputs/heartbeat"
  
  subdirs:
    - "github_skills"
    - "health_checks"
    - "knowledge_extraction"
    
  naming:
    pattern: "{task}_{timestamp}"
    date_format: "%Y%m%d_%H%M%S"
    
# æ—¥èªŒé…ç½®
logging:
  level: "info"
  format: "json"
  file: "./logs/heartbeat_automation.log"
  max_size: "10M"
  backup_count: 5
  
# éŒ¯èª¤è™•ç†
error_handling:
  on_task_failure: "retry"
  max_retries: 3
  retry_delay: 60
  fallback_action: "notify"
  
  on_linkage_failure: "skip"
  notify_on_failure: true

# ç›£æ§é…ç½®
monitoring:
  enabled: true
  metrics:
    - "task_execution_time"
    - "success_rate"
    - "linkage_chain_length"
    - "notification_delivery"
  
  alerts:
    - condition: "success_rate < 0.8"
      action: "notify"
      message: "âš ï¸ å¿ƒè·³ä»»å‹™æˆåŠŸç‡ä½æ–¼ 80%"
    - condition: "task_execution_time > 300"
      action: "notify"
      message: "âš ï¸ ä»»å‹™åŸ·è¡Œæ™‚é–“éé•·"
